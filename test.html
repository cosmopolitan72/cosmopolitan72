<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" href="imgs/cos bo 1.png" type="image/png">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@400;600&display=swap" rel="stylesheet">
  <title>cosmopolitan</title>
  <style>
    /* 기존의 스타일 코드는 생략하겠습니다. */
  </style>
</head>

<body>
  <div id="content" style="display:none;">
    <h1 class="text-center">제한된 컨텐츠입니다.</h1>
    <p>안녕하세요</p>
    <img id="cosImage" src="imgs/chat.png" alt="사진">
  </div>

  <!-- 사용자 정의 입력 대화 상자 -->
  <div id="custom-prompt">
    <div>
      <img src="imgs/cos bo 1.png" alt="Your Logo" id="logo-img" />
      <p style="font-weight: 600; color: #c5c5c5;">Enter your password:</p>
      <input type="password" id="password-input" placeholder="Password" class="form-control">
      <button id="submit-btn" class="btn">Submit</button>
      <button id="cancel-btn" class="btn">Cancel</button>
    </div>
  </div>

  <script>
    const customPrompt = document.getElementById("custom-prompt");
    const passwordInput = document.getElementById("password-input");
    const submitBtn = document.getElementById("submit-btn");
    const cancelBtn = document.getElementById("cancel-btn");

    customPrompt.style.display = "block";

    passwordInput.addEventListener("keyup", function(event) {
      if (event.key === "Enter") {
        event.preventDefault();
        submitBtn.click();
      }
    });

    submitBtn.onclick = async () => {
      const enteredPassword = passwordInput.value;
      const result = await findPageWithPassword(enteredPassword);

      if (!result.found) {
        alert("잘못된 비밀번호입니다. 다시 시도해 주세요.");
      } else {
        customPrompt.style.display = "none";
        window.location.href = result.page;
      }
    };

    cancelBtn.onclick = () => {
      customPrompt.style.display = "none";
      alert("인증이 취소되었습니다.");
      window.location.href = "https://cosmopolitan72.github.io/cosmopolitan72/"; 
    };

    async function findPageWithPassword(password) {
      const basePath = "https://cosmopolitan72.github.io/cosmopolitan72/pages/"; // 비밀번호가 있는 폴더 경로
      const searchUrl = `${basePath}search.json`; // 만들 search.json 파일을 지정
    
      let result = { found: false, page: null };
      try {
        const response = await fetch(searchUrl);
        const pages = await response.json();
        for (const pageObj of pages) {
          const pageUrl = `${basePath}${pageObj.file}`;
          const res = await fetch(pageUrl);
          const html = await res.text();
          const parser = new DOMParser();
          const doc = parser.parseFromString(html, "text/html");
          const meta = doc.querySelector('head meta[name="psw"]');
          if (meta && meta.content === password) {
            result = { found: true, page: pageUrl };
            break;
          }
        }
      } catch (err) {
        console.error(err);
      }
      return result;
    }
  </script>
</body>
</html>
